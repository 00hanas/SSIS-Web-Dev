(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{8525:(e,t,a)=>{"use strict";a.d(t,{N:()=>r});let r=(0,a(63503).UU)("https://liofppzunluhdsrbwogc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxpb2ZwcHp1bmx1aGRzcmJ3b2djIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3OTAyODQsImV4cCI6MjA3ODM2NjI4NH0.AHUpJy0wD4HEw1ImsdL4CKWYvLn0sfUelXUH_VmQpNM")},17336:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var r=a(95155),s=a(37772),l=a(97003),n=a(7220),o=a(42179),i=a(53e3),c=a(50533),d=a(36820),u=a(57972);let m=(0,a(28619).A)((0,r.jsx)("path",{d:"M12 2c-4.97 0-9 4.03-9 9 0 4.17 2.84 7.67 6.69 8.69L12 22l2.31-2.31C18.16 18.67 21 15.17 21 11c0-4.97-4.03-9-9-9m0 2c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m0 14.3c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22"}),"PersonPin");var h=a(15239),p=a(33952),g=a(12115),x=a(54679),j=a(33789),f=a(90235),v=a(47507),N=a(72907),y=a(61184),w=a(41152),b=a(8525);function C(e){let{onStudentAdded:t}=e,[a,s]=(0,g.useState)(null),[n,o]=(0,g.useState)([]),[i,c]=(0,g.useState)(""),[d,u]=(0,g.useState)(""),[m,p]=(0,g.useState)(""),[C,S]=(0,g.useState)(""),[k,I]=(0,g.useState)(""),[F,D]=(0,g.useState)(""),[E,T]=(0,g.useState)(""),[L,U]=(0,g.useState)(!1),[A,P]=(0,g.useState)(null),[J,O]=(0,g.useState)(null),$=(0,g.useRef)(null),[G,M]=(0,g.useState)(!1);(0,g.useEffect)(()=>{(async()=>{try{let e=await (0,N.em)();o(e)}catch(e){console.error("Failed to load programs:",e)}})()},[]);let z=async()=>{if(M(!0),!i.trim()||!d.trim()||!m.trim()||!C.trim()||!k.trim()||!F.trim()){T("Please fill in all fields."),M(!1);return}if(!/^\d{4}-\d{4}$/.test(i.trim())){T("Student ID must follow the format XXXX-XXXX using digits only."),M(!1);return}if(A){if(!["image/jpg","image/jpeg","image/png","image/svg+xml"].includes(A.type)){T("Only image files are allowed."),$.current&&($.current.value=""),M(!1);return}if(A.size>2097152){T("Photo must be smaller than 2 MB."),$.current&&($.current.value=""),M(!1);return}}try{let e="/student-icon.jpg";if(A){let t="".concat(i,"/").concat(Date.now(),"-").concat(A.name),{error:a}=await b.N.storage.from("students-photos").upload(t,A);if(a)console.error("Upload error:",a);else{let{data:a}=b.N.storage.from("students-photos").getPublicUrl(t);e=a.publicUrl}}let a=await (0,y.s5)(i,d,m,C,parseInt(k),F,e||"/student-icon.jpg");s(a.student),R(),U(!1),null==t||t()}catch(e){e instanceof Error?"Student ID already exists"===e.message?T("Student ID (".concat(i,") is already taken.")):"Missing required fields"===e.message?T("Please fill in all required fields."):T(e.message||"Something went wrong. Try again."):T("Something went wrong. Try again.")}finally{M(!1)}},R=()=>{c(""),u(""),p(""),S(""),I(""),D(""),P(null),O(null),T("")};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.lG,{open:L,onOpenChange:e=>{e?U(!0):(R(),U(!1))},children:[(0,r.jsx)(x.zM,{asChild:!0,className:"cursor-pointer",children:(0,r.jsx)(l.$,{variant:"default",size:"sm",children:"Add Student"})}),(0,r.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(x.c7,{children:[(0,r.jsx)(x.L3,{children:"Add a new Student"}),(0,r.jsx)(x.rr,{children:"Fill in the details below to add a student."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)(f.J,{htmlFor:"photo",children:"Photo (optional)"}),(0,r.jsxs)("div",{className:"relative flex items-center justify-center",children:[J?(0,r.jsx)(h.default,{src:J,alt:"Preview",width:120,height:120,className:"!h-20 !w-20 rounded-full border border-gray-300 object-cover"}):(0,r.jsx)("div",{className:"flex !h-20 !w-20 cursor-pointer items-center justify-center rounded-full bg-gray-100 text-gray-500",children:(0,r.jsx)("span",{className:"text-3xl font-bold",children:"+"})}),J&&(0,r.jsx)(l.$,{variant:"destructive",size:"icon",onClick:()=>{P(null),O(null),$.current&&($.current.value="")},className:"absolute -top-2 -right-2 !h-5 !w-5 rounded-full bg-red-500 text-white hover:bg-red-600",children:"✕"})]}),(0,r.jsx)(l.$,{variant:"outline",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},className:"px-4 py-2",children:J?"Change Photo":"Upload Photo"}),(0,r.jsx)("input",{ref:$,id:"photo",type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=(null==(t=e.target.files)?void 0:t[0])||null;P(a),a&&O(URL.createObjectURL(a))}})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"studentID",children:"Student ID"}),(0,r.jsx)(j.p,{id:"studentID",placeholder:"e.g. 2023-0001",value:i,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>4&&(t=t.slice(0,4)+"-"+t.slice(4,8)),c(t)},maxLength:9})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"firstName",children:"First Name"}),(0,r.jsx)(j.p,{id:"firstName",placeholder:"e.g. Juhanara",value:d,onChange:e=>u(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"lastName",children:"Last Name"}),(0,r.jsx)(j.p,{id:"lastName",placeholder:"e.g. Saluta",value:m,onChange:e=>p(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"programCode",children:"Program"}),(0,r.jsxs)(v.l6,{value:C,onValueChange:S,children:[(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select a program"})}),(0,r.jsx)(v.gC,{className:"max-h-[300px] overflow-y-auto",children:Array.isArray(n)&&n.map(e=>(0,r.jsxs)(v.eb,{value:e.programCode,children:[e.programName," (",e.programCode,")"]},e.programCode))})]})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"yearLevel",children:"Year Level"}),(0,r.jsxs)(v.l6,{value:k,onValueChange:I,children:[(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select year level"})}),(0,r.jsxs)(v.gC,{children:[(0,r.jsx)(v.eb,{value:"1",children:"1"}),(0,r.jsx)(v.eb,{value:"2",children:"2"}),(0,r.jsx)(v.eb,{value:"3",children:"3"}),(0,r.jsx)(v.eb,{value:"4",children:"4"}),(0,r.jsx)(v.eb,{value:"5",children:"5"})]})]})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"gender",children:"Gender"}),(0,r.jsxs)(v.l6,{value:F,onValueChange:D,children:[(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select a gender"})}),(0,r.jsxs)(v.gC,{children:[(0,r.jsx)(v.eb,{value:"Female",children:"Female"}),(0,r.jsx)(v.eb,{value:"Male",children:"Male"})]})]})]}),E&&(0,r.jsx)("p",{className:"mt-2 text-sm text-red-600",children:E})]}),(0,r.jsxs)(x.Es,{children:[(0,r.jsx)(l.$,{type:"button",variant:"outline",className:"mr-auto cursor-pointer",onClick:R,children:"Reset"}),(0,r.jsx)(x.HM,{asChild:!0,children:(0,r.jsx)(l.$,{className:"cursor-pointer",variant:"secondary",children:"Cancel"})}),(0,r.jsx)(l.$,{className:"cursor-pointer",type:"submit",onClick:z,disabled:G,children:G?"Saving...":"Save"})]})]})]}),a&&(0,r.jsx)(w.p,{entityType:"Student",entity:{code:a.studentID,name:"".concat(a.firstName," ").concat(a.lastName)},actionType:"added",onClose:()=>s(null)})]})}function S(e){let{student:t,visible:a,onClose:s,onStudentUpdated:n}=e,[o,i]=(0,g.useState)([]),[c,d]=(0,g.useState)(t.studentID),[u,m]=(0,g.useState)(t.firstName),[p,b]=(0,g.useState)(t.lastName),[C,S]=(0,g.useState)(t.programCode),[k,I]=(0,g.useState)(t.yearLevel),[F,D]=(0,g.useState)(t.gender),[E,T]=(0,g.useState)(null),[L,U]=(0,g.useState)(""),[A,P]=(0,g.useState)(t.photoUrl),[J,O]=(0,g.useState)(null),$=(0,g.useRef)(null),[G,M]=(0,g.useState)(!1);(0,g.useEffect)(()=>{a&&(d(t.studentID),m(t.firstName),b(t.lastName),S(t.programCode),I(t.yearLevel),D(t.gender),P(t.photoUrl),U(""),(async()=>{try{let e=await (0,y.oC)(t.studentID);d(e.studentID),m(e.firstName),b(e.lastName),S(e.programCode),I(e.yearLevel),D(e.gender),P(e.photoUrl)}catch(e){console.error("Failed to fetch student data:",e)}})())},[a,t.studentID,t.firstName,t.lastName,t.programCode,t.yearLevel,t.gender,t.photoUrl]),(0,g.useEffect)(()=>{(async()=>{try{let e=await (0,N.em)();i(e)}catch(e){console.error("Failed to load programs:",e),i([])}})()},[]);let z=async()=>{M(!0);let e=t.studentID;if(!c.trim()||!u.trim()||!p.trim()||!C.trim()||!k.toString().trim()||!F.trim()){U("Please fill in all fields."),M(!1);return}if(!/^\d{4}-\d{4}$/.test(c.trim())){U("Student ID must follow the format YYYY-NNNN."),M(!1);return}if(c.trim()===e.trim()&&u.trim()===t.firstName.trim()&&p.trim()===t.lastName.trim()&&C.trim()===t.programCode.trim()&&k===t.yearLevel&&F.trim()===t.gender.trim()&&t.photoUrl===A){U("No changes detected."),M(!1);return}if(J){if(!["image/jpg","image/jpeg","image/png","image/svg+xml"].includes(J.type)){U("Only image files are allowed."),M(!1);return}if(J.size>2097152){U("Photo must be smaller than 2 MB."),$.current&&($.current.value=""),M(!1);return}}try{let a=A||"/student-icon.jpg";if(J){let t=await (0,y.O7)(e,c.trim(),J);t&&(a=t)}else if(e!==c.trim()){let t=await (0,y.O7)(e,c.trim());t&&(a=t)}else"/student-icon.jpg"===A&&t.photoUrl&&"/student-icon.jpg"!==t.photoUrl&&(await (0,y.j6)(e,t.photoUrl),a="/student-icon.jpg");let r=await (0,y.dp)(e,c.trim(),u.trim(),p.trim(),C.trim(),k,F.trim(),a);T(r),U("")}catch(e){e instanceof Error?"Student ID already exists"===e.message?U("Student ID (".concat(c,") is already taken.")):"Missing required fields"===e.message?U("Please fill in all required fields."):U(e.message||"Something went wrong. Try again."):U("Something went wrong. Try again.")}finally{M(!1)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.lG,{open:a,onOpenChange:e=>{e||s()},children:(0,r.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(x.c7,{children:[(0,r.jsx)(x.L3,{children:"Edit Student"}),(0,r.jsx)(x.rr,{children:"Update the fields below to modify this student."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)(f.J,{htmlFor:"photo",children:"Photo (optional)"}),(0,r.jsxs)("div",{className:"relative flex items-center justify-center",children:[A&&"/student-icon.jpg"!==A?(0,r.jsx)(h.default,{src:A,alt:"Current student photo",width:120,height:120,className:"!h-20 !w-20 rounded-full border border-gray-300 object-cover"}):(0,r.jsx)("div",{className:"flex !h-20 !w-20 cursor-pointer items-center justify-center rounded-full bg-gray-100 text-gray-500",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},children:(0,r.jsx)("span",{className:"text-3xl font-bold",children:"+"})}),A&&"/student-icon.jpg"!==A&&(0,r.jsx)(l.$,{variant:"destructive",size:"icon",onClick:()=>{O(null),P("/student-icon.jpg"),$.current&&($.current.value="")},className:"absolute -top-2 -right-2 !h-5 !w-5 rounded-full bg-red-500 text-white hover:bg-red-600",children:"✕"})]}),(0,r.jsx)(l.$,{variant:"outline",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},className:"px-4 py-2",children:A&&"/student-icon.jpg"!==A?"Change Photo":"Upload Photo"}),(0,r.jsx)("input",{ref:$,id:"photo",type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=(null==(t=e.target.files)?void 0:t[0])||null;O(a),a&&P(URL.createObjectURL(a))}})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"studentID",children:"Student ID"}),(0,r.jsx)(j.p,{id:"studentID",value:c,placeholder:"e.g. 2023-0001",onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>4&&(t=t.slice(0,4)+"-"+t.slice(4,8)),d(t)},maxLength:9})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"firstName",children:"First Name"}),(0,r.jsx)(j.p,{id:"firstName",value:u,placeholder:"e.g. Juhanara",onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"lastName",children:"Last Name"}),(0,r.jsx)(j.p,{id:"lastName",value:p,placeholder:"e.g. Saluta",onChange:e=>b(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"programCode",children:"Program"}),(0,r.jsxs)(v.l6,{value:C,onValueChange:S,children:[(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select a program"})}),(0,r.jsx)(v.gC,{children:o.map(e=>(0,r.jsxs)(v.eb,{value:e.programCode,children:[e.programName," (",e.programCode,")"]},e.programCode))})]})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"yearLevel",children:"Year Level"}),(0,r.jsxs)(v.l6,{value:k.toString(),onValueChange:e=>I(Number(e)),children:[(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select year level"})}),(0,r.jsxs)(v.gC,{children:[(0,r.jsx)(v.eb,{value:"1",children:"1"}),(0,r.jsx)(v.eb,{value:"2",children:"2"}),(0,r.jsx)(v.eb,{value:"3",children:"3"}),(0,r.jsx)(v.eb,{value:"4",children:"4"}),(0,r.jsx)(v.eb,{value:"5",children:"5"})]})]})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(f.J,{htmlFor:"gender",children:"Gender"}),(0,r.jsxs)(v.l6,{value:F,onValueChange:D,children:[(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select a gender"})}),(0,r.jsxs)(v.gC,{children:[(0,r.jsx)(v.eb,{value:"Female",children:"Female"}),(0,r.jsx)(v.eb,{value:"Male",children:"Male"})]})]})]}),L&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:L})]}),(0,r.jsxs)(x.Es,{children:[(0,r.jsx)(l.$,{type:"button",variant:"outline",className:"mr-auto cursor-pointer",onClick:()=>{d(""),m(""),b(""),S(""),I(0),D(""),P(""),U("")},children:"Reset"}),(0,r.jsx)(x.HM,{asChild:!0,children:(0,r.jsx)(l.$,{className:"cursor-pointer",variant:"secondary",children:"Cancel"})}),(0,r.jsx)(l.$,{className:"cursor-pointer",type:"submit",onClick:z,disabled:G,children:G?"Saving Changes...":"Save"})]})]})}),E&&(0,r.jsx)(w.p,{entityType:"Student",entity:{code:E.studentID,name:"".concat(E.firstName," ").concat(E.lastName)},actionType:"updated",onClose:()=>{T(null),null==n||n(),s()}})]})}function k(e){let{student:t,visible:a,onClose:s,onStudentDeleted:n}=e,[o,i]=(0,g.useState)(null),c=async()=>{try{await (0,y.jJ)(t.studentID),await (0,y.LP)(t.studentID),i(t)}catch(e){console.error("Failed to delete student:",e)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.lG,{open:a,onOpenChange:e=>{e||s()},children:(0,r.jsxs)(x.Cf,{children:[(0,r.jsx)(x.c7,{children:(0,r.jsx)(x.L3,{children:"Confirm Deletion"})}),(0,r.jsxs)("p",{children:["Are you sure you want to delete"," ",(0,r.jsxs)("strong",{children:[t.firstName," ",t.lastName]})," ","(",t.studentID,")"]}),(0,r.jsxs)(x.Es,{children:[(0,r.jsx)(l.$,{className:"cursor-pointer",variant:"secondary",onClick:()=>s(),children:"Cancel"}),(0,r.jsx)(l.$,{className:"cursor-pointer",variant:"destructive",onClick:c,children:"Delete"})]})]})}),o&&(0,r.jsx)(w.p,{entityType:"Student",entity:{code:t.studentID,name:"".concat(t.firstName," ").concat(t.lastName)},actionType:"deleted",onClose:()=>{i(null),null==n||n(),s()}})]})}var I=a(4259),F=a(15310),D=a(99733),E=a(68122),T=a(32467),L=a(83101),U=a(25016);let A=(0,L.F)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function P(e){let{className:t,variant:a,asChild:s=!1,...l}=e,n=s?T.DX:"span";return(0,r.jsx)(n,{"data-slot":"badge",className:(0,U.cn)(A({variant:a}),t),...l})}function J(e){let{student:t,visible:a,onClose:s}=e,[l,n]=(0,g.useState)(t),[o,i]=(0,g.useState)([]);(0,g.useEffect)(()=>{a&&(async()=>{try{let e=await (0,y.oC)(t.studentID);n(e)}catch(e){console.error("Failed to fetch student data:",e)}})()},[a,t.studentID]),(0,g.useEffect)(()=>{(async()=>{try{let e=await (0,N.em)();i(e)}catch(e){console.error("Failed to load programs:",e),i([])}})()},[]);let c=o.find(e=>e.programCode===l.programCode);return(0,r.jsx)(x.lG,{open:a,onOpenChange:e=>{e||s()},children:(0,r.jsxs)(x.Cf,{className:"sm:max-w-[400px]",children:[(0,r.jsx)(x.c7,{children:(0,r.jsx)(x.L3,{children:"Student Profile"})}),(0,r.jsxs)("div",{className:"container mt-5 mb-3",children:[(0,r.jsxs)("div",{className:"mb-8 flex flex-row",children:[l.photoUrl?(0,r.jsx)(h.default,{src:l.photoUrl,alt:"".concat(l.firstName," ").concat(l.lastName),width:150,height:150,className:"!h-15 !w-15 rounded-full object-cover"}):null,(0,r.jsxs)("div",{className:"ml-4 flex flex-col",children:[(0,r.jsxs)("span",{className:"mb-1 text-[18px] font-medium tracking-wide",children:[l.firstName," ",l.lastName]}),(0,r.jsx)(P,{className:"text-[10px] tracking-wide",children:l.studentID})]})]}),(0,r.jsxs)("div",{className:"mr-5 ml-5 flex flex-col gap-2 rounded-sm p-5 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-5 flex flex-col",children:[(0,r.jsx)("span",{className:"text-muted-foreground mb-2 text-[11px] tracking-wide",children:"Program"}),c?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("span",{className:"text-sm",children:c.programName})}):(0,r.jsx)("span",{className:"text-sm",children:l.programCode})]}),(0,r.jsxs)("div",{className:"mb-5 flex flex-col",children:[(0,r.jsx)("span",{className:"text-muted-foreground mb-2 text-[11px] tracking-wide",children:"College"}),c?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("span",{className:"text-sm",children:c.collegeCode})}):(0,r.jsx)("span",{className:"text-sm",children:"N/A"})]}),(0,r.jsxs)("div",{className:"mb-5 flex flex-col",children:[(0,r.jsx)("span",{className:"text-muted-foreground mb-2 text-[11px] tracking-wide",children:"Year Level"}),(0,r.jsx)("span",{className:"text-sm",children:l.yearLevel})]}),(0,r.jsxs)("div",{className:"mb-5 flex flex-col",children:[(0,r.jsx)("span",{className:"text-muted-foreground mb-2 text-[11px] tracking-wide",children:"Gender"}),(0,r.jsx)("span",{className:"text-sm",children:l.gender})]})]})]})]})})}function O(){let e,t,{authenticated:a,loading:x}=(0,I.A)(),[j,f]=(0,g.useState)(!1),[N,w]=(0,g.useState)([]),[b,T]=(0,g.useState)(0),[L,U]=(0,g.useState)(null),[A,P]=(0,g.useState)(null),[O,$]=(0,g.useState)(null),[G,M]=(0,g.useState)(""),[z,R]=(0,g.useState)("all"),[V,X]=(0,g.useState)("studentID"),[Y,q]=(0,g.useState)("asc"),[B,_]=(0,g.useState)(1),[H,K]=(0,g.useState)(1),Q=(0,g.useCallback)(async()=>{f(!0);try{let e=await (0,y.kd)(B,10,G,z,V,Y);w(e.students),K(e.pages),T(e.total)}catch(e){console.error("Failed to load students:",e)}finally{f(!1)}},[B,G,z,V,Y]);return((0,g.useEffect)(()=>{a&&Q()},[a,Q]),x)?(0,r.jsx)(F.J,{}):a||x?(0,r.jsxs)("div",{className:"container w-full justify-center px-6",children:[(0,r.jsx)("div",{className:"container mb-2",children:(0,r.jsx)("h1",{className:"mb text-2xl font-semibold tracking-wide",children:"Students"})}),(0,r.jsxs)("div",{className:"mb-4 flex",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(D.D,{value:G,onChange:M,total:b}),(0,r.jsxs)(v.l6,{value:z,onValueChange:e=>R(e),children:[(0,r.jsx)(v.bq,{className:"w-[150px] cursor-pointer",children:(0,r.jsx)(v.yv,{placeholder:"Search By"})}),(0,r.jsxs)(v.gC,{children:[(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"all",children:"Search By"}),(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"studentID",children:"Student ID"}),(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"firstName",children:"First Name"}),(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"lastName",children:"Last Name"}),(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"programCode",children:"Program Code"}),(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"yearLevel",children:"Year Level"}),(0,r.jsx)(v.eb,{className:"cursor-pointer",value:"gender",children:"Gender"})]})]})]}),(0,r.jsx)("div",{className:"ml-auto",children:(0,r.jsx)(C,{onStudentAdded:Q})})]}),(0,r.jsx)("div",{className:"container",children:j?(0,r.jsx)(E.E,{className:"container mx-auto h-[600px] rounded-xl py-10"}):0===N.length?(0,r.jsx)("div",{className:"text-muted-foreground py-6 text-center",children:"No data."}):(0,r.jsxs)("div",{className:"mb-2 opacity-100 transition-opacity duration-300",children:[(0,r.jsx)(p.b,{columns:(e=e=>{U(e)},t=e=>{P(e)},[{accessorKey:"photoUrl",size:60,header:"Photo",cell:e=>{let{row:t}=e;console.log("Row data:",t.original);let a=t.original.photoUrl,s="".concat(t.original.firstName," ").concat(t.original.lastName);return a?(0,r.jsx)(h.default,{src:a,alt:s,width:40,height:40,className:"!h-10 !w-10 rounded-full object-cover"}):(0,r.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-200 text-xs",children:"N/A"})}},{accessorKey:"studentID",size:150,header:()=>(0,r.jsxs)(l.$,{onClick:()=>{"studentID"===V?q("asc"===Y?"desc":"asc"):(X("studentID"),q("asc"))},className:"text-foreground cursor-pointer bg-transparent hover:bg-transparent",children:["Student ID","studentID"===V?"asc"===Y?(0,r.jsx)(i.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(c.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(d.A,{className:"text-primary ml-2 h-4 w-4"})]}),cell:e=>{var t;let{getValue:a}=e;return null!=(t=a())?t:"—"}},{accessorKey:"firstName",header:()=>(0,r.jsxs)(l.$,{onClick:()=>{"firstName"===V?q("asc"===Y?"desc":"asc"):(X("firstName"),q("asc"))},className:"text-foreground cursor-pointer bg-transparent hover:bg-transparent",children:["First Name","firstName"===V?"asc"===Y?(0,r.jsx)(i.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(c.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(d.A,{className:"text-primary ml-2 h-4 w-4"})]}),cell:e=>{var t;let{getValue:a}=e;return null!=(t=a())?t:"—"}},{accessorKey:"lastName",header:()=>(0,r.jsxs)(l.$,{onClick:()=>{"lastName"===V?q("asc"===Y?"desc":"asc"):(X("lastName"),q("asc"))},className:"text-foreground cursor-pointer bg-transparent hover:bg-transparent",children:["Last Name","lastName"===V?"asc"===Y?(0,r.jsx)(i.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(c.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(d.A,{className:"text-primary ml-2 h-4 w-4"})]}),cell:e=>{var t;let{getValue:a}=e;return null!=(t=a())?t:"—"}},{accessorKey:"programCode",header:()=>(0,r.jsxs)(l.$,{onClick:()=>{"programCode"===V?q("asc"===Y?"desc":"asc"):(X("programCode"),q("asc"))},className:"text-foreground cursor-pointer bg-transparent hover:bg-transparent",children:["Program Code","programCode"===V?"asc"===Y?(0,r.jsx)(i.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(c.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(d.A,{className:"text-primary ml-2 h-4 w-4"})]}),cell:e=>{let{row:t}=e,a=t.getValue("programCode");return"N/A"===a?(0,r.jsx)("span",{className:"text-muted-foreground italic",children:"N/A"}):a}},{accessorKey:"yearLevel",header:()=>(0,r.jsxs)(l.$,{onClick:()=>{"yearLevel"===V?q("asc"===Y?"desc":"asc"):(X("yearLevel"),q("asc"))},className:"text-foreground cursor-pointer bg-transparent hover:bg-transparent",children:["Year Level","yearLevel"===V?"asc"===Y?(0,r.jsx)(i.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(c.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(d.A,{className:"text-primary ml-2 h-4 w-4"})]}),cell:e=>{var t;let{getValue:a}=e;return null!=(t=a())?t:"—"}},{accessorKey:"gender",header:()=>(0,r.jsxs)(l.$,{onClick:()=>{"gender"===V?q("asc"===Y?"desc":"asc"):(X("gender"),q("asc"))},className:"text-foreground cursor-pointer bg-transparent hover:bg-transparent",children:["Gender","gender"===V?"asc"===Y?(0,r.jsx)(i.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(c.A,{className:"text-primary ml-2 h-4 w-4"}):(0,r.jsx)(d.A,{className:"text-primary ml-2 h-4 w-4"})]}),cell:e=>{var t;let{getValue:a}=e;return null!=(t=a())?t:"—"}},{id:"actions",size:100,cell:a=>{let{row:i}=a,c=i.original;return(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)(n.rI,{children:[(0,r.jsx)(n.ty,{asChild:!0,children:(0,r.jsxs)(l.$,{variant:"ghost",className:"h-5 w-8 cursor-pointer p-0",children:[(0,r.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,r.jsx)(s.A,{className:"h-4 w-4"})]})}),(0,r.jsxs)(n.SQ,{align:"end",children:[(0,r.jsx)(n.lp,{children:"Actions"}),(0,r.jsx)(n.mB,{}),(0,r.jsxs)(l.$,{variant:"ghost",className:"flex w-full cursor-pointer justify-between",onClick:()=>e(c),children:[(0,r.jsx)("span",{children:"View"}),(0,r.jsx)(m,{className:"text-muted-foreground h-4 w-4 justify-end"})]}),(0,r.jsx)(n.mB,{className:"mr-2 ml-2"}),(0,r.jsxs)(l.$,{variant:"ghost",className:"flex w-full cursor-pointer justify-between",onClick:()=>t(c),children:[(0,r.jsx)("span",{children:"Edit"}),(0,r.jsx)(o.A,{className:"text-muted-foreground ml-auto h-4 w-4 justify-end"})]}),(0,r.jsxs)(l.$,{variant:"ghost",className:"flex w-full cursor-pointer justify-between",onClick:()=>$(c),children:[(0,r.jsx)("span",{children:"Delete"}),(0,r.jsx)(u.A,{className:"text-muted-foreground h-4 w-4 justify-end"})]})]})]})})}}]),data:N,page:B,totalPages:H,setPage:_}),L&&(0,r.jsx)(J,{student:L,visible:!0,onClose:()=>U(null)}),A&&(0,r.jsx)(S,{student:A,visible:!0,onClose:()=>P(null),onStudentUpdated:()=>{Q(),P(null)}}),O&&(0,r.jsx)(k,{student:O,visible:!0,onClose:()=>$(null),onStudentDeleted:()=>{Q(),$(null)}})]})})]}):(0,r.jsx)("div",{className:"text-muted-foreground py-6 text-center",children:"Redirecting to login..."})}},49766:(e,t,a)=>{Promise.resolve().then(a.bind(a,17336))},61184:(e,t,a)=>{"use strict";a.d(t,{LP:()=>d,O7:()=>x,VN:()=>l,cm:()=>u,dp:()=>c,j6:()=>j,jJ:()=>g,kd:()=>n,lM:()=>h,oC:()=>i,s5:()=>o,tC:()=>m,tH:()=>p});var r=a(8525);let s="http://127.0.0.1:5000/api/students",l=async()=>{let e=await fetch("".concat(s,"/list"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),t=await e.json();return console.log("Fetched students:",t.students),t},n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"all",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"studentID",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"asc",o=new URLSearchParams({page:e.toString(),per_page:t.toString(),search:a,searchBy:"all"===r?"all":r,sortBy:l,order:n}),i=await fetch("".concat(s,"?").concat(o.toString()),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),c=await i.json();return console.log("Total students:",c.total),c},o=async(e,t,a,r,l,n,o)=>{let i=await fetch("".concat(s,"/create"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentID:e,firstName:t,lastName:a,programCode:r,yearLevel:l,gender:n,photoUrl:o})});if(!i.ok)throw Error((await i.json()).error||"Unknown error");return await i.json()},i=async e=>{let t=await fetch("".concat(s,"/").concat(e),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw console.error("Fetch failed with status:",t.status),Error("Failed to fetch student");let a=await t.json();return console.log("Fetched student:",a),a},c=async(e,t,a,r,l,n,o,i)=>{let c=await fetch("".concat(s,"/").concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentID:t,firstName:a,lastName:r,programCode:l,yearLevel:n,gender:o,photoUrl:i})}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to update student");return d.student},d=async e=>{let t=await fetch("".concat(s,"/").concat(e),{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error((await t.json()).message||"Failed to delete student");return await t.json()},u=async e=>{let t=new URLSearchParams;"all"!==e&&t.set("programCode",e);let a=await fetch("".concat(s,"/by-program?").concat(t.toString()),{method:"GET",credentials:"include"});if(!a.ok)throw Error("Failed to fetch students by program");return(await a.json()).students};async function m(){let e=await fetch("http://127.0.0.1:5000/api/students/count-by-program",{method:"GET",credentials:"include"});if(!e.ok)throw Error("Failed to fetch counts");return e.json()}async function h(){let e=await fetch("http://127.0.0.1:5000/api/students/count-by-gender",{method:"GET",credentials:"include"});if(!e.ok)throw Error("Failed to fetch gender counts");return e.json()}async function p(){let e=await fetch("http://127.0.0.1:5000/api/students/total",{method:"GET",credentials:"include"});return(await e.json()).total}async function g(e){try{let t="".concat(e,"/"),{data:a,error:s}=await r.N.storage.from("students-photos").list(t,{limit:1e3});if(s)return void console.error("Error listing files:",s);if(!a||0===a.length)return void console.log("No files found in folder:",t);let l=a.map(e=>"".concat(t).concat(e.name)),{error:n}=await r.N.storage.from("students-photos").remove(l);if(n)return void console.error("Error deleting files:",n);console.log("Deleted all files under ".concat(t))}catch(e){console.error("Unexpected error deleting folder:",e)}}async function x(e,t,a){let s=null;if(e!==t){let{data:a,error:l}=await r.N.storage.from("students-photos").list(e);if(l)return console.error("Error listing files:",l),null;for(let l of a){let a="".concat(e,"/").concat(l.name),n="".concat(t,"/").concat(l.name);await r.N.storage.from("students-photos").copy(a,n),await r.N.storage.from("students-photos").remove([a]);let{data:o}=r.N.storage.from("students-photos").getPublicUrl(n);s=o.publicUrl}}if(a){let{data:e,error:l}=await r.N.storage.from("students-photos").list(t);if(!l&&e&&e.length>0){let a=e.map(e=>"".concat(t,"/").concat(e.name));await r.N.storage.from("students-photos").remove(a)}let n="".concat(t,"/").concat(Date.now(),"-").concat(a.name),{error:o}=await r.N.storage.from("students-photos").upload(n,a,{upsert:!0});if(!o){let{data:e}=r.N.storage.from("students-photos").getPublicUrl(n);s=e.publicUrl}}return s}async function j(e,t){try{let e=t.split("/students-photos/");if(e.length<2)return!1;let a=e[1],{error:s}=await r.N.storage.from("students-photos").remove([a]);if(s)throw s;return!0}catch(e){return console.error("Failed to delete photo:",e),!1}}},72907:(e,t,a)=>{"use strict";a.d(t,{C$:()=>s,El:()=>c,GD:()=>d,VC:()=>l,Xv:()=>i,em:()=>n,rC:()=>o,ys:()=>u});let r="http://127.0.0.1:5000/api/programs",s=async()=>{let e=await fetch("".concat(r,"/list"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),t=await e.json();return console.log("Fetched programs:",t.programs),t},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"all",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"programCode",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"asc",o=new URLSearchParams({page:e.toString(),per_page:t.toString(),search:a,searchBy:"all"===s?"all":s,sortBy:l,order:n}),i=await fetch("".concat(r,"?").concat(o.toString()),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),c=await i.json();return console.log("Total programs:",c.total),c},n=async()=>{let e=await fetch("".concat(r,"/dropdown"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)throw console.error("Server returned:",await e.text()),Error("Failed to fetch programs");return(await e.json()).programs},o=async(e,t,a)=>{let s=await fetch("".concat(r,"/create"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({programCode:e,programName:t,collegeCode:a})});if(!s.ok)throw Error((await s.json()).error||"Unknown error");return await s.json()},i=async e=>{let t=await fetch("".concat(r,"/").concat(e),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw console.error("Fetch failed with status:",t.status),Error("Failed to fetch program");let a=await t.json();return console.log("Fetched program:",a),a},c=async(e,t,a,s)=>{let l=await fetch("".concat(r,"/").concat(e),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({programCode:t,programName:a,collegeCode:s})}),n=await l.json();if(!l.ok)throw Error(n.error||"Failed to update program");return n.program},d=async e=>{let t=await fetch("".concat(r,"/").concat(e),{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error((await t.json()).message||"Failed to delete program");return await t.json()};async function u(){let e=await fetch("http://127.0.0.1:5000/api/programs/total",{method:"GET",credentials:"include"});return(await e.json()).total}}},e=>{e.O(0,[186,629,179,40,14,239,91,503,52,441,255,358],()=>e(e.s=49766)),_N_E=e.O()}]);